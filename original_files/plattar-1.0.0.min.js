function PlattarIntegration(){this.embedUrl="",this.qrUrl="",this.linkOverride=void 0,this.usdzUrl,this.realityUrl,this.gltfUrl,this.araction=void 0;var p=this,m={};p.apiUrl="https://app.plattar.com/",p.cdnUrl="https://cdn.plattar.com/";var t,e=(t=document.createElement("a")).relList&&t.relList.supports&&t.relList.supports("ar"),i=navigator.vendor&&-1<navigator.vendor.indexOf("Apple")&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),n=navigator.userAgent||navigator.vendor||window.opera;var a,v={dimensions:{source:"embed",pageTitle:document.title,pageURL:location.href,referrer:document.referrer},track:function(t,e){var i=e||{};"object"==typeof t&&(i=t,t="track"),Object.keys(v.dimensions).forEach(function(t){i[t]=v.dimensions[t]});var n={event:t,application_id:i.applicationId,origin:"production",data:i},a=new XMLHttpRequest;a.open("POST","https://c.plattar.space/api/v2/analytics"),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(JSON.stringify(n))},generateUuid:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);var i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,a=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&a|128]+t[a>>8&255]+"-"+t[a>>16&255]+t[a>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]).toLowerCase()}};try{a=localStorage.getItem("plattar_user_id")}catch(t){a=v.generateUuid()}a||(a=v.generateUuid(),localStorage.setItem("plattar_user_id",a)),v.dimensions.user_id=a;var r,o,d=new URL(location.href);function s(t){var s=t.sceneId,c=t.variationId,u=t.variationSku,l=t.callback;m={},s&&f("GET",p.apiUrl+"api/v2/scene/"+s+"?include=sceneproduct.product.productvariation.filemodel,application,product.productvariation.filemodel",function(t){var e,i;"vertical"==t.data.attributes.custom_json.anchor&&(m.setVertical=!0);var n,a,r,o,d=t.included.filter(function(t){return"productvariation"===t.type}).sort(function(t,e){return t.attributes.sort_order-e.attributes.sort_order});if(u){if(!(i=d.find(function(t){return t.attributes.sku===u})))return void console.error("No variation with sku "+u+" in this scene.");productId=i.attributes.product_id,e=t.included.find(function(t){return t.id===productId})}else if(c){if(!(i=d.find(function(t){return t.id===c})))return void console.error("No variation with id "+c+" in this scene.");productId=i.attributes.product_id,e=t.included.find(function(t){return t.id===productId})}else(e=t.included.find(function(t){return"product"===t.type}))&&(i=d.find(function(t){return t.id===e.attributes.product_variation_id}));e?(n=t.included.find(function(t){return t.id===i.attributes.file_model_id}))?(a=t.included.find(function(t){return"application"==t.type}),v.dimensions.applicationId=a.id,v.dimensions.applicationTitle=a.attributes.title,v.dimensions.sceneId=s,v.dimensions.sceneTitle=t.data.attributes.title,v.dimensions.productId=e.id,v.dimensions.productTitle=t.data.attributes.title,v.dimensions.productSKU=t.data.attributes.sku,v.dimensions.variationId=i.id,v.dimensions.variationTitle=i.attributes.title,v.dimensions.variationSKU=i.attributes.sku,m.url=i.attributes.variation_url||e.attributes.product_url,v.track("pageview"),p.embedUrl=p.apiUrl+"webgleditor/preview/index.html?sceneid="+s,p.embedUrl+="&productid="+e.id,p.embedUrl+="&variationid="+i.id,p.qrUrl="https://converter.plattar.space/api/v2/qrcode?base64="+btoa(p.embedUrl),p.gltfUrl=p.cdnUrl+n.attributes.path+n.attributes.original_filename,n.attributes.usdz_filename?(p.usdzUrl=p.cdnUrl+n.attributes.path+n.attributes.usdz_filename,l&&l()):f("HEAD",r=p.cdnUrl+n.attributes.path+"model-conv.usdz",function(){p.usdzUrl=r,l&&l()},function(){l&&l()}),n.attributes.reality_filename?(p.realityUrl=p.cdnUrl+n.attributes.path+n.attributes.reality_filename,l&&l()):f("HEAD",o=p.cdnUrl+n.attributes.path+"model-conv.reality",function(){p.realityUrl=o,l&&l()},function(){l&&l()})):l&&l("no file"):l&&l("no product")},function(t){throw l&&l(t),t})}function f(t,e,i,n){var a=new XMLHttpRequest;a.open(t,e,!0),a.onload=function(t){var e;200==a.status?(a.response&&(e=JSON.parse(a.response)),i(e)):n&&n(t)},a.onerror=function(t){n&&n(t)},a.send(null)}function c(){var i,n,a;void 0!==document.hidden?(n="hidden",a="visibilitychange"):void 0!==document.msHidden?(n="msHidden",a="msvisibilitychange"):void 0!==document.webkitHidden&&(n="webkitHidden",a="webkitvisibilitychange"),document.addEventListener(a,function t(){var e;document[n]?i=new Date:(e=(new Date).getTime()-i.getTime(),v.track({eventAction:"View Time",viewTime:e,eventLabel:e}),document.removeEventListener(a,t,!1))},!1)}d.searchParams.get("araction")&&(r=new CustomEvent("webarcallback",{detail:{action:d.searchParams.get("araction"),data:v.dimensions}}),setTimeout(function(){window.dispatchEvent(r)},1e3)),this.init=function(t,e,i){"string"==typeof e?function(t){var o=t.productId,d=t.variationId,s=t.callback,e=p.apiUrl+"api/v2/product/"+o+"?include=productvariation,productvariation.filemodel,scene.application";if(m={},!o)return;f("GET",e,function(t){var e,i,n,a=t.included.find(function(t){return t.id===d}),r=t.included.find(function(t){return t.id===a.attributes.file_model_id});r?(e=t.included.find(function(t){return"application"==t.type}),v.dimensions.applicationId=e.id,v.dimensions.applicationTitle=e.attributes.title,v.dimensions.sceneId=t.data.attributes.scene_id,v.dimensions.sceneTitle=t.data.attributes.title,v.dimensions.productId=o,v.dimensions.productTitle=t.data.attributes.title,v.dimensions.productSKU=t.data.attributes.sku,v.dimensions.variationId=d,v.dimensions.variationTitle=a.attributes.title,v.dimensions.variationSKU=a.attributes.sku,m.url=a.attributes.variation_url||t.data.attributes.product_url,v.track("pageview"),p.embedUrl=p.apiUrl+"webgleditor/preview/index.html?productid="+o+"&variationid="+d,p.qrUrl="https://converter.plattar.space/api/v2/qrcode?base64="+btoa(p.embedUrl),p.gltfUrl=p.cdnUrl+r.attributes.path+r.attributes.original_filename,r.attributes.usdz_filename?(p.usdzUrl=p.cdnUrl+r.attributes.path+r.attributes.usdz_filename,s&&s()):f("HEAD",i=p.cdnUrl+r.attributes.path+"model-conv.usdz",function(){p.usdzUrl=i,s&&s()},function(){s&&s()}),r.attributes.reality_filename?(p.realityUrl=p.cdnUrl+r.attributes.path+r.attributes.reality_filename,s&&s()):f("HEAD",n=p.cdnUrl+r.attributes.path+"model-conv.reality",function(){p.realityUrl=n,s&&s()},function(){s&&s()})):s&&s("no file")},function(t){throw s&&s(t),t})}({productId:t,variationId:e,callback:i}):"object"==typeof t?(e&&(t.callback=e),s(t)):s({sceneId:t,callback:e})},this.canAugment=(o=new RegExp("(${rules.join('|')})","ig"),!Boolean(n.match(o))&&(/Macintosh|iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?!/\bFB[\w_]+\//.test(navigator.userAgent)&&!/\bInstagram/i.test(navigator.userAgent)&&e:!!/android/i.test(navigator.userAgent))),this.augmentAvailable=function(){return!!this.canAugment&&(this.canQuickLook()||this.canSceneViewer()||this.canRealityViewer())},this.canQuickLook=function(){return!!p.usdzUrl&&(!(!/Macintosh|iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream)&&(p.canAugment&&p.usdzUrl))},this.canRealityViewer=function(){return!!p.realityUrl&&(!(!/Macintosh|iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream)&&(p.canAugment&&i&&13<=function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||0,10)]}if(/Mac/.test(navigator.platform)){t=navigator.appVersion.match(/Version\/(\d+)\.(\d+)\.?(\d+)?/);return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||0,10)]}return[-1,-1,-1]}()[0]&&p.realityUrl))},this.canSceneViewer=function(){return!!p.gltfUrl&&(p.canAugment&&/android/i.test(navigator.userAgent))},this.canFaceTrack=function(){return!0},this.startAugment=function(t){if(p.canRealityViewer())this.startRealityViewer();else if(p.canQuickLook())this.startQuicklook();else{if(!p.canSceneViewer())return t&&t(),new Error("No AR available");this.startSceneViewer(t)}},this.startQuicklook=function(){var i=document.createElement("a");i.setAttribute("rel","ar"),i.appendChild(document.createElement("img")),v.dimensions.device="ios";var t=p.usdzUrl;(m.url||p.araction)&&(i.addEventListener("message",function t(e){"_apple_ar_quicklook_button_tapped"==e.data&&(p.araction?(e=new CustomEvent("webarcallback",{detail:{action:p.araction,data:v.dimensions}}),window.dispatchEvent(e)):/^http/.test(m.url)?location.href=m.url:/araction=/.test(m.url)&&(e=new CustomEvent("webarcallback",{detail:{action:m.url.match(/araction=(.*)/gm)[0].split("=")[1],data:v.dimensions}}),window.dispatchEvent(e))),document.body.removeChild(i),i.removeEventListener("message",t),v.track({eventAction:"CallToAction"})},!1),document.body.appendChild(i),p.araction?t+="#callToAction="+p.araction:/^http/.test(m.url)?t+="#callToAction=View Online":/araction=/.test(m.url)&&(t+="#callToAction="+m.url.match(/araction=(.*)/gm)[0].split("=")[1]),t+="&checkoutTitle="+v.dimensions.productTitle,t+="&checkoutSubtitle="+v.dimensions.variationTitle,t+="&price= "),t=encodeURI(t),i.setAttribute("href",t),i.click(),v.dimensions.eventCategory="Quick Look",v.track({eventAction:"Start Augment"}),c()},this.startRealityViewer=function(){var t=document.createElement("a");t.setAttribute("rel","ar"),t.appendChild(document.createElement("img")),v.dimensions.device="ios",t.setAttribute("href",p.realityUrl),t.click(),v.dimensions.eventCategory="Reality Viewer",v.track({eventAction:"Start Augment"}),c()},this.startSceneViewer=function(t){var e,i=new URL(p.gltfUrl),n=encodeURIComponent(p.linkOverride||location.href);(m.url||p.araction)&&(p.araction?((n=new URL(location.href)).searchParams.set("araction",p.araction),n=encodeURIComponent(n.href)):/^http/.test(m.url)?n=encodeURIComponent(m.url):/araction=/.test(m.url)&&(e=m.url.match(/araction=(.*)/gm)[0].split("=")[1],(n=new URL(location.href)).searchParams.set("araction",e),n=encodeURIComponent(n.href)));var a=encodeURIComponent(location.href+"#no-ar-fallback");encodeURIComponent(document.title);intent="intent://arvr.google.com/scene-viewer/1.1",intent+="?file="+i,intent+="&mode=ar_preferred",intent+="&link="+n,intent+="&title=<b>"+encodeURI(v.dimensions.productTitle)+"</b><br>"+encodeURI(v.dimensions.variationTitle),m.setVertical&&(intent+="&enable_vertical_placement=true"),intent+=" #Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;",intent+="S.browser_fallback_url="+a+";end;";var r=document.createElement("a");r.setAttribute("href",intent),r.click(),v.dimensions.device="android",v.dimensions.eventCategory="Scene Viewer",v.track({eventAction:"Start Augment"}),t&&window.addEventListener("hashchange",function(){t()},{once:!0}),c()}}PlattarIntegration.canAugment=function(){var t,e=(t=document.createElement("a")).relList&&t.relList.supports&&t.relList.supports("ar");navigator.vendor&&-1<navigator.vendor.indexOf("Apple")&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&navigator.userAgent.indexOf("FxiOS");return/Macintosh|iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?e:!!/android/i.test(navigator.userAgent)}();
